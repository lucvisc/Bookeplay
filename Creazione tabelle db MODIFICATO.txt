DROP DATABASE IF EXISTS bookeplay;
CREATE DATABASE bookeplay;
USE bookeplay;

CREATE TABLE IF NOT EXISTS  `Account` (
  `id` int(4) not null AUTO_INCREMENT,
  `username` varchar(45)  NOT NULL UNIQUE,
  `password` VARCHAR(45) not NULL,
  `email` varchar(45) NULL,
  `telnumb` char(10) NOT NULL,
  `conto` float NULL,
  `descrizione` varchar(150) NULL,
  `activate` Boolean not null,
  PRIMARY KEY (`id`) )
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Utente` (
  `idAcc` int(4) not null,
  `name` VARCHAR(45) not NULL,
  `surname` VARCHAR(45) not NULL,
  `dataNascita` DATE NULL,
  `gender` ENUM('M','F') NULL,
  `tipo` enum('registrato', 'admin'),
  PRIMARY KEY (idAcc),
  FOREIGN KEY (idAcc) REFERENCES Account(`id`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Indirizzo` (
  `idAcc` int(4) not NULL AUTO_INCREMENT,
  `Comune` VARCHAR(45) not NULL,
  `Provincia` varchar(45) NULL,
  `CAP` CHAR(5) not NULL,
  `Via` varchar(45) not null,
  `NumCivico` char(3) not null,
  PRIMARY KEY (`Via`, `CAP`),
  FOREIGN KEY (idAcc) REFERENCES Utente(`idAcc`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `FasceOrarie` (
  `idFascia` int(2) not null,
  `Fascia` char(60) not null,
  PRIMARY KEY (`idFascia`)
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Giorno` (
  `Giorno` varchar(10) not null,
  `idFasciaOraria` int(2) not null,
   PRIMARY KEY (`Giorno`, `idFasciaOraria`),
   FOREIGN KEY (idFasciaOraria) REFERENCES FasceOrarie(`idFascia`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Prenotazione` (
  `idP` int(5) not null AUTO_INCREMENT,
  `Giorno` VARCHAR(45) not NULL,
  `FasciaOraria` int(2) not NULL,
  `Quota` int NULL,
  
  PRIMARY KEY (`idP`),
  FOREIGN KEY (Giorno) REFERENCES Giorno(`Giorno`),
  FOREIGN KEY (FasciaOraria) REFERENCES FasceOrarie(`idFascia`)  ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Pren_creata` (
  `idPren` int(5) not null,
  `idAcc` int(4) not null,
   PRIMARY KEY (`idPren`, `idAcc`),
   FOREIGN KEY (idPren) REFERENCES Prenotazione(`idP`) ON DELETE CASCADE ON UPDATE CASCADE,
   FOREIGN KEY (idAcc) REFERENCES Account(`id`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Pren_Partecipa` (
  `idPren` int(5) not null,
  `idAcc` int(4) not null,
   PRIMARY KEY (`idPren`, `idAcc`),
   FOREIGN KEY (idPren) REFERENCES Prenotazione(`idP`) ON DELETE CASCADE ON UPDATE CASCADE,
   FOREIGN KEY (idAcc) REFERENCES Account(`id`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Partita` (
  `idPren` int(5) not null AUTO_INCREMENT,
  `MaxNumGioc` int NULL,
  `Livello` enum('principiante','medio','avanzato','professionista') DEFAULT 'medio',
  `Note` varchar(255) NULL,
  PRIMARY KEY (`idPren`),
  FOREIGN KEY (idPren) REFERENCES Prenotazione(`idP`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;