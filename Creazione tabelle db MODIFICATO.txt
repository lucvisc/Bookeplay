DROP DATABASE IF EXISTS bookeplay;
CREATE DATABASE bookeplay;
USE bookeplay;

CREATE TABLE IF NOT EXISTS  `Account` (
  `email` varchar(45) NULL UNIQUE,
  `username` varchar(45)  NOT NULL UNIQUE,
  `password` VARCHAR(45) not NULL,
  `telnumb` char(10) NOT NULL,
  `conto` float NULL,
  `descrizione` varchar(150) NULL,
  `activate` Boolean not null,
  PRIMARY KEY (`email`) )
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Utente` (
  `email` varchar(45) not null,
  `name` VARCHAR(45) not NULL,
  `surname` VARCHAR(45) not NULL,
  `dataNascita` DATE NULL,
  `gender` ENUM('M','F') NULL,
  `tipo` enum('registrato', 'admin'),
  PRIMARY KEY (email),
  FOREIGN KEY (email) REFERENCES Account(`email`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Indirizzo` (
  `email` varchar(45) not NULL,
  `Comune` VARCHAR(45) not NULL,
  `Provincia` varchar(45) NULL,
  `CAP` CHAR(5) not NULL,
  `Via` varchar(45) not null,
  `NumCivico` char(3) not null,
  PRIMARY KEY (`Via`, `CAP`),
  FOREIGN KEY (email) REFERENCES Utente(`email`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `FasceOrarie` (
  `giornoFascia` varchar(10) not null,
  `08:00-09:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `09:00-10:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `10:00-11:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `11:00-12:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `12:00-13:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `15:00-16:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `16:00-17:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `17:00-18:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `18:00-19:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `19:00-20:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `20:00-21:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  `21:00-22:00` enum('Disponibile','Non Disponible') DEFAULT 'Disponibile',
  PRIMARY KEY (`giornoFascia`)
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Giorno` (
  `idP` int(5) not null AUTO_INCREMENT,
  `giorno` varchar(10) not null,
   PRIMARY KEY (`idP`),
   FOREIGN KEY (`giorno`) REFERENCES fasceOrarie(`giornoFascia`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `prenotazione` (
  `idP` int(5) not null AUTO_INCREMENT,
  `quota` int NULL,
  `livello` enum('principiante','medio','avanzato','professionista') DEFAULT 'medio',
  `note` varchar(255) NULL,
   PRIMARY KEY (`idP`)
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Pren_creata` (
  `idPren` int(5) not null,
  `email` varchar(60) not null,
   PRIMARY KEY (`idPren`, `email`),
   FOREIGN KEY (idPren) REFERENCES Prenotazione(`idP`) ON DELETE CASCADE ON UPDATE CASCADE,
   FOREIGN KEY (email) REFERENCES account(`email`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Pren_Partecipa` (
  `idPren` int(5) not null,
  `email` varchar(60) not null,
   PRIMARY KEY (`idPren`, `email`),
   FOREIGN KEY (idPren) REFERENCES Prenotazione(`idP`) ON DELETE CASCADE ON UPDATE CASCADE,
   FOREIGN KEY (email) REFERENCES Account(`email`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE mediauser (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `filename` varchar(50) NOT NULL,
    `type` varchar(50) NOT NULL,
    `emailutente`  varchar (50) NOT NULL,
    `immagine` blob NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (emailutente) REFERENCES Account(email)  ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE=InnoDB;