DROP DATABASE IF EXISTS bookeplay;
CREATE DATABASE bookeplay;
USE bookeplay;

CREATE TABLE IF NOT EXISTS  `Account` (
  `email` varchar(45) NULL UNIQUE,
  `username` varchar(45)  NOT NULL UNIQUE,
  `password` VARCHAR(45) not NULL,
  `telnumb` char(10) NOT NULL,
  `conto` float NULL,
  `descrizione` varchar(150) NULL,
  `activate` Boolean not null,
  PRIMARY KEY (`email`) )
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Utente` (
  `email` varchar(45) not null,
  `name` VARCHAR(45) not NULL,
  `surname` VARCHAR(45) not NULL,
  `dataNascita` DATE NULL,
  `gender` ENUM('M','F') NULL,
  `tipo` enum('registrato', 'admin'),
  PRIMARY KEY (email),
  FOREIGN KEY (email) REFERENCES Account(`email`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Indirizzo` (
  `email` varchar(45) not NULL,
  `Comune` VARCHAR(45) not NULL,
  `Provincia` varchar(45) NULL,
  `CAP` CHAR(5) not NULL,
  `Via` varchar(45) not null,
  `NumCivico` char(3) not null,
  PRIMARY KEY (`Via`, `CAP`),
  FOREIGN KEY (email) REFERENCES Utente(`email`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Giorno` (
  `Giorno` varchar(10) not null,
  `FasciaOraria` varchar(11) not null,
   PRIMARY KEY (`Giorno`, `FasciaOraria`),

   CHECK (FasciaOraria in ('10:11','11:12','12:13','15:16','17:18','19:20','20:21','21:22'))
)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `prenotazione` (
  `idP` int(5) not null AUTO_INCREMENT,
  `Quota` int not NULL,
  `livello` enum('principiante','medio','avanzato','professionista') DEFAULT 'medio',
  `Giorno` VARCHAR(45) not NULL,
  `FasciaOraria` varchar(11) not NULL,
  `note` varchar(100),
  `organizzatore` varchar(45) not null,
   
  PRIMARY KEY (`idP`),
  FOREIGN KEY (Giorno,FasciaOraria) REFERENCES Giorno(`Giorno`,`FasciaOraria`) ON DELETE CASCADE ON UPDATE CASCADE

)
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `Pren_Partecipa` (
  `idPren` int(5) not null,
  `email` varchar(60) not null,
   PRIMARY KEY (`idPren`, `email`),
   FOREIGN KEY (idPren) REFERENCES Prenotazione(`idP`) ON DELETE CASCADE ON UPDATE CASCADE,
   FOREIGN KEY (email) REFERENCES Account(`email`) ON DELETE CASCADE ON UPDATE CASCADE
)
ENGINE = InnoDB;

CREATE TABLE mediauser (

    `filename` varchar(50) NOT NULL,
    `type` varchar(50) NOT NULL,
    `emailutente`  varchar (50) NOT NULL,
    `immagine` blob NOT NULL,
    PRIMARY KEY (emailutente)  
)
ENGINE=InnoDB;

